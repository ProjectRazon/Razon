# Directory Traversal

A *directory traversal* (also known as *path traversal*) is a type of attack which allows an adversary to read files outside the web root directory and usually occurs when there is no proper user input sanitisation. 

If an application is vulnerable to path traversal, then one can abuse relative paths to escape from the web root and access arbitrary files on the file system. 

![[res/Basic Directory Traversal.png]]

One should look for directory traversals in the URL path.

# Filter Bypass

URL encoding can be used to bypass many filters which try to filter out the `../` sequence from user input because they literally look for this specific characters and not their URL representations. The URL encoding of the `.` character is `%2e` and the `/` character gets encoded to `%2f`. The whole sequence can therefore be represented as `%2e%2e%2f`.

Some filters try to strip out the `../` sequence before handling requests. Oftentimes, however, these filters are *non-recursive* and only check the input once. Since the filter only goes over the string once and does not check the resulting string as well, the sequence `....//` will be changed to `../` after the middle `../` is removed. 

# Prevention

One should avoid passing user input to file system APIs entirely. If this is absolutely impossible to implement, then user input should be validated before processing. In the ideal case this should happen by comparing the input with a whitelist of permitted values. At the very least, one should verify that the user input contains only permitted characters such as alphanumeric ones.

After such validation, the user input should be appended to the base directory and the file system API should be used canonicalise the resulting path. Ultimately, one should verify that this canonical path begins with the base directory. 